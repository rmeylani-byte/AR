<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>QR Pattern AR Debug</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
  <style>
    html,body { margin:0; height:100%; overflow:hidden; }
    #msg { position:fixed; left:0; right:0; top:0; padding:8px 12px;
           font:14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial;
           color:#fff; background:rgba(0,0,0,.45); z-index:10; text-align:center; }
    #msg b { color:#7cf; }
  </style>
</head>
<body>
  <div id="msg">Allow camera. Aim at your <b>QR-based pattern marker</b>.
    If model fails, a red cube will appear as a fallback.</div>

  <a-scene
    embedded
    vr-mode-ui="enabled:false"
    renderer="logarithmicDepthBuffer:true; colorManagement:true; physicallyCorrectLights:true"
    arjs="sourceType: webcam; debugUIEnabled:false;">
    
    <!-- PRELOAD ASSETS with CORS -->
    <a-assets timeout="20000">
      <!-- 1) Your pattern marker (.patt). This URL MUST return 200 OK -->
      <!-- Test it by opening the URL directly in your browser -->
      <!-- Example: https://raw.githubusercontent.com/rmeylani-byte/AR/main/pattern-marker.patt -->
      <a-asset-item id="marker" src="PUT_YOUR_PATT_URL_HERE"></a-asset-item>

      <!-- 2) Your GLB model -->
      <!-- Example: https://raw.githubusercontent.com/rmeylani-byte/AR/main/model.glb -->
      <a-asset-item id="model" src="PUT_YOUR_GLB_URL_HERE" crossorigin="anonymous"></a-asset-item>
    </a-assets>

    <!-- Use your custom PATTERN marker -->
    <a-marker type="pattern" url="PUT_YOUR_PATT_URL_HERE">
      <!-- Try to load GLB -->
      <a-entity id="modelEntity"
        gltf-model="#model"
        position="0 0 0"
        rotation="-90 0 0"
        scale="0.05 0.05 0.05">
      </a-entity>

      <!-- Fallback cube (hidden unless model fails) -->
      <a-box id="fallbackCube" position="0 0.5 0" depth="1" height="1" width="1" color="#EF2D5E" visible="false"></a-box>

      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 1"></a-entity>
      <a-entity light="type: directional; intensity: 0.9" position="1 1 0"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Simple runtime diagnostics in the console
    const msg = (t)=>document.getElementById('msg').textContent=t;

    // Check that assets actually fetched
    window.addEventListener('load', () => {
      const patt = document.querySelector('#marker').getAttribute('src');
      const glb  = document.querySelector('#model').getAttribute('src');
      console.log('[AR] pattern URL:', patt);
      console.log('[AR] model URL  :', glb);
    });

    // Model load handlers
    const entity = document.getElementById('modelEntity');
    const cube   = document.getElementById('fallbackCube');

    entity.addEventListener('model-loaded', () => {
      console.log('[AR] GLB loaded');
      msg('Model loaded. Aim at your QR pattern.');
    });

    entity.addEventListener('model-error', (e) => {
      console.warn('[AR] GLB error:', e?.detail?.error || e);
      cube.setAttribute('visible', true);
      msg('Model failed to load. Showing fallback cube. Check GLB URL / CORS.');
    });
  </script>
</body>
</html>
